<div id="content" style="box-sizing:border-box; max-width:980px; margin:0 auto; padding:45px;">
        Loading...
</div>

<!-- Marked.js -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script>
        // Default nav links for CodePen / testing
        let navLinks = [
                { title: "Main", url: "docs/README.md", tags: ["intro", "overview"] },
                { title: "Example", url: "docs/example.md", tags: ["howto", "sample"] },
                { title: "Install", url: "docs/install.md", tags: ["setup", "howto"] },
                { title: "Advanced Config", url: "docs/advanced.md", tags: ["config", "advanced", "expert"] },
                { title: "API", url: "docs/api.md", tags: ["reference", "api", "dev"] }
        ];

        function renderMenuLinks(filter = "") {
                const navList = document.getElementById('nav-list');
                navList.innerHTML = '';
                let shown = 0;
                const filterLower = filter.trim().toLowerCase();

                navLinks.forEach((item, idx) => {
                        if (filterLower) {
                                const match = item.title.toLowerCase().includes(filterLower) ||
                                        (item.tags && item.tags.some(tag => tag.toLowerCase().includes(filterLower)));
                                if (!match) return;
                        }

                        const li = document.createElement('li');
                        const a = document.createElement('a');
                        a.textContent = item.title;
                        a.href = "#";
                        a.setAttribute('data-md', item.url);
                        if (idx === 0 && !filterLower) a.classList.add('active');

                        // Append tags
                        if (item.tags && item.tags.length) {
                                const tags = document.createElement('span');
                                tags.className = "tags";
                                tags.style.opacity = "0.6";
                                tags.style.marginLeft = "0.3rem";
                                tags.textContent = item.tags.map(t => "#" + t).join(" ");
                                a.appendChild(tags);
                        }

                        li.appendChild(a);
                        navList.appendChild(li);
                        shown++;
                });

                if (shown === 0) {
                        const li = document.createElement('li');
                        li.innerHTML = '<span style="opacity:0.7;font-size:1em;padding:0.7em 1.3em;">No matches</span>';
                        navList.appendChild(li);
                }
        }

        function loadMarkdown(filename) {
                fetch(filename)
                        .then(res => res.ok ? res.text() : Promise.reject("Not found"))
                        .then(text => document.getElementById('content').innerHTML = marked.parse(text))
                        .catch(() => document.getElementById('content').innerHTML = "<p>Could not load " + filename + ".</p>");
        }

        function attachNavHandlers() {
                const navList = document.getElementById('nav-list');
                const links = navList.querySelectorAll("a");

                function setActive(link) {
                        links.forEach(l => l.classList.remove("active"));
                        link.classList.add("active");
                }

                links.forEach(link => {
                        link.addEventListener("click", e => {
                                e.preventDefault();
                                setActive(link);
                                loadMarkdown(link.getAttribute("data-md"));
                        });
                });
        }

        document.addEventListener("DOMContentLoaded", () => {
                const tagFilter = document.getElementById("tag-filter");

                renderMenuLinks();
                attachNavHandlers();

                tagFilter.addEventListener("input", () => {
                        renderMenuLinks(tagFilter.value);
                        attachNavHandlers();
                });

                const firstLink = document.querySelector('#nav-list a');
                if (firstLink) loadMarkdown(firstLink.getAttribute("data-md"));
        });

        // Production: fetch dynamic JSON from scan.php and overwrite navLinks

        fetch('scan.php')
                .then(res => res.json())
                .then(data => {
                        navLinks = data.map(item => ({
                                title: item.title,
                                url: item.url,
                                tags: item.tags || []
                        }));
                        renderMenuLinks();
                        attachNavHandlers();
                });

</script>